# 代码质量检查

<cite>
**本文档引用的文件**  
- [package.json](file://frontend/package.json)
- [tsconfig.json](file://frontend/tsconfig.json)
- [vite.config.ts](file://frontend/vite.config.ts)
- [Makefile](file://Makefile)
</cite>

## 目录
1. [前端代码质量保障](#前端代码质量保障)
2. [后端代码格式化与检查](#后端代码格式化与检查)
3. [构建过程中的类型安全控制](#构建过程中的类型安全控制)
4. [CI/CD与提交钩子集成建议](#cicd与提交钩子集成建议)
5. [常见警告修复指南](#常见警告修复指南)
6. [自定义规则扩展方法](#自定义规则扩展方法)

## 前端代码质量保障

前端项目通过 `package.json` 中定义的 `lint` 脚本实现静态代码检查，使用 ESLint 作为核心工具，结合 TypeScript 解析器和 Vue 插件，覆盖 `.vue`、`.ts`、`.js` 等多种文件类型。该脚本执行时会自动修复可修复的问题，并遵循 `.gitignore` 忽略配置，避免对非源码文件进行检查。

ESLint 配置依赖于 `@typescript-eslint/eslint-plugin` 和 `eslint-plugin-vue`，确保对 Vue 3 的组合式 API 和 TypeScript 类型语法提供精准支持。通过统一的代码风格约束，项目可有效预防潜在错误，如未定义变量、类型不匹配、不规范的命名等。

**Section sources**
- [package.json](file://frontend/package.json#L7-L10)

## 后端代码格式化与检查

后端 Go 代码的质量保障通过 `Makefile` 中的 `lint` 目标实现。该目标集成 `go vet` 和 `gofmt` 两个官方工具：
- `go vet`：静态分析工具，用于检测常见错误，如不可达代码、格式化字符串不匹配、空指针解引用等。
- `gofmt -l`：格式化检查工具，验证代码是否符合 Go 官方风格规范，输出不符合格式的文件列表。

此机制确保所有提交的 Go 代码在语法正确性与格式一致性上达到标准，无需人工干预即可自动化执行。

**Section sources**
- [Makefile](file://Makefile#L60-L86)

## 构建过程中的类型安全控制

前端构建过程通过 `package.json` 中的 `build` 脚本实现类型安全控制：`"build": "vue-tsc && vite build"`。其中：
- `vue-tsc`：TypeScript 编译器的 Vue 扩展，用于在不实际编译代码的情况下执行类型检查，验证 `.vue` 文件中的 `<script>` 块类型正确性。
- `vite build`：Vite 构建命令，在类型检查通过后执行实际打包。

`tsconfig.json` 配置文件通过 `@vue/tsconfig/tsconfig.dom.json` 继承基础配置，并设置路径别名 `@/*` 指向 `src/*`，提升模块导入的可维护性。`vite.config.ts` 中的 `resolve.alias` 与之对应，确保开发服务器和构建时路径解析一致。

**Section sources**
- [package.json](file://frontend/package.json#L8)
- [tsconfig.json](file://frontend/tsconfig.json#L1-L11)
- [vite.config.ts](file://frontend/vite.config.ts#L1-L22)

## CI/CD与提交钩子集成建议

为确保代码质量在团队协作中持续保持，建议在 CI/CD 流水线中集成以下步骤：
1. **pre-commit 钩子**：使用 `husky` 和 `lint-staged` 工具，在每次提交前自动运行 `npm run lint` 和 `vue-tsc --noEmit`，阻止不符合规范的代码提交。
2. **CI 流水线检查**：在 GitHub Actions 或 GitLab CI 中添加构建阶段，执行 `make lint` 和 `make build`，确保所有代码通过前后端检查。
3. **自动化测试集成**：结合 `make test` 命令运行单元测试，确保代码变更不破坏现有功能。

此举可实现“提交即检查”的质量闭环，降低代码审查负担，提升项目稳定性。

**Section sources**
- [Makefile](file://Makefile#L60-L86)
- [package.json](file://frontend/package.json#L7-L10)

## 常见警告修复指南

### TypeScript 类型错误
- **错误**：`Property 'xxx' does not exist on type '...'`  
  **修复**：检查接口定义是否缺失字段，或使用类型断言（谨慎使用）。
- **错误**：`Argument of type 'xxx' is not assignable to parameter of type 'yyy'`  
  **修复**：确保函数调用参数类型匹配，必要时添加类型转换或联合类型定义。

### ESLint 风格警告
- **错误**：`Missing return type on function`  
  **修复**：为函数显式添加返回类型，如 `(): void => {}`。
- **错误**：`Unexpected any. Specify a different type`  
  **修复**：避免使用 `any`，改用具体类型或 `unknown`。

### Go 代码检查警告
- **警告**：`possible misuse of unsafe.Pointer`  
  **修复**：审查指针操作，确保符合 `unsafe` 包使用规范。
- **警告**：`printf format %s has arg of type int`  
  **修复**：修正格式化字符串与参数类型的不匹配。

## 自定义规则扩展方法

### 扩展 ESLint 规则
在项目根目录创建 `.eslintrc.js` 文件，继承现有配置并覆盖规则：
```js
module.exports = {
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:vue/vue3-recommended'
  ],
  rules: {
    '@typescript-eslint/no-explicit-any': 'warn',
    'vue/multi-word-component-names': 'off'
  }
};
```

### 扩展 TypeScript 配置
在 `tsconfig.json` 中添加编译选项以增强类型检查：
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

### 扩展 Go 检查工具
可引入 `golint` 或 `staticcheck` 替代或补充 `go vet`，提供更严格的检查：
```makefile
lint:
	cd backend && staticcheck ./...
```

通过以上机制，qoder 项目可建立完整的代码质量保障体系，确保前后端代码在类型安全、风格统一和潜在错误检测方面达到高标准。