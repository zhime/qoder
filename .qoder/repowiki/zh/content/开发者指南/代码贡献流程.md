# 代码贡献流程

<cite>
**本文档引用文件**  
- [Makefile](file://Makefile)
- [backend/internal/app/app.go](file://backend/internal/app/app.go)
- [backend/internal/api/router.go](file://backend/internal/api/router.go)
- [backend/internal/config/config.go](file://backend/internal/config/config.go)
- [backend/internal/app/config_manager.go](file://backend/internal/app/config_manager.go)
- [frontend/package.json](file://frontend/package.json)
</cite>

## 目录
1. [分支管理策略](#分支管理策略)
2. [提交信息规范](#提交信息规范)
3. [Pull Request审查流程](#pull-request审查流程)
4. [本地测试执行](#本地测试执行)
5. [代码格式化与静态检查](#代码格式化与静态检查)
6. [构建与验证](#构建与验证)
7. [CI/CD流程概览](#cicd流程概览)
8. [文档同步更新原则](#文档同步更新原则)

## 分支管理策略

本项目采用基于功能和修复的分支命名策略，确保代码变更的可追溯性和组织性。所有新功能开发应在 `feature/` 前缀的分支中进行，所有缺陷修复应在 `fix/` 前缀的分支中进行。

例如：
- `feature/user-authentication`：用于用户认证功能开发
- `fix/login-bug`：用于修复登录相关缺陷

主分支为 `main`，受保护，禁止直接推送。所有变更必须通过 Pull Request 合并。

**Section sources**
- [app.go](file://backend/internal/app/app.go#L1-L212)

## 提交信息规范

所有提交信息必须遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范，格式如下：

```
<type>(<scope>): <description>
```

支持的类型包括：
- `feat`：新增功能
- `fix`：问题修复
- `docs`：文档更新
- `style`：代码格式调整（不影响逻辑）
- `refactor`：代码重构
- `test`：测试相关变更
- `chore`：构建过程或辅助工具变动

示例：
```
feat(user): 添加用户角色权限控制
fix(auth): 修复JWT令牌刷新逻辑缺陷
docs(api): 更新服务器监控API文档
```

**Section sources**
- [router.go](file://backend/internal/api/router.go#L1-L115)

## Pull Request审查流程

所有 Pull Request 必须满足以下条件方可合并：
1. 至少一名核心成员批准
2. 所有 CI 检查通过（包括构建、测试、代码检查）
3. 变更描述清晰，包含变更目的、影响范围和测试方法
4. 相关文档已同步更新（如API变更）

建议在 PR 描述中使用模板：
```
## 变更说明
[简要描述变更内容]

## 影响范围
[说明影响的模块或功能]

## 测试方法
[说明如何验证变更]
```

**Section sources**
- [config.go](file://backend/internal/config/config.go#L1-L98)

## 本地测试执行

在提交代码前，必须运行本地测试以确保功能正常。

**后端测试**：  
使用 Go 自带测试框架运行所有测试用例：
```bash
make test-backend
```
或进入 `backend` 目录后执行：
```bash
go test -v ./...
```

**前端测试**：  
当前前端测试暂未实现，但需确保界面功能正常。未来将通过以下命令运行：
```bash
cd frontend && npm run test
```

**Section sources**
- [Makefile](file://Makefile#L15-L24)

## 代码格式化与静态检查

提交前必须执行代码格式化和静态检查，确保代码风格统一。

**后端格式化**：
```bash
gofmt -w .
go vet ./...
```

**前端格式化**：
```bash
cd frontend && npm run lint
```
该命令将自动修复可修复的问题。

**静态检查**：  
项目提供统一检查命令，提交前必须运行：
```bash
make lint
```
此命令将执行后端 `go vet` 和 `gofmt` 检查，以及前端 ESLint 检查。

**Section sources**
- [Makefile](file://Makefile#L64-L73)

## 构建与验证

提交前必须验证构建是否成功。

**完整构建**：
```bash
make build
```
该命令将：
1. 构建后端二进制文件至 `bin/devops-backend`
2. 构建前端静态资源至 `frontend/dist/`

**构建验证**：  
使用以下命令验证构建完整性：
```bash
make build-backend
make build-frontend
```

**清理构建文件**：
```bash
make clean
```

**Section sources**
- [Makefile](file://Makefile#L9-L54)

## CI/CD流程概览

项目使用 GitHub Actions 或 GitLab CI 进行持续集成与部署。

**触发条件**：
- 推送至 `main` 分支
- 打开或更新 Pull Request

**执行步骤**：
1. **代码检出**：获取最新代码
2. **环境准备**：安装 Go、Node.js 依赖
   ```bash
   make install-deps
   ```
3. **代码检查**：执行 `make lint`
4. **运行测试**：执行 `make test`
5. **构建验证**：执行 `make build`
6. **部署**（仅 `main` 分支）：构建 Docker 镜像并部署
   ```bash
   make docker-build
   make docker-up
   ```

**Section sources**
- [Makefile](file://Makefile#L75-L86)

## 文档同步更新原则

代码变更时，相关文档必须同步更新，确保文档与代码一致。

**必须更新文档的场景**：
- 修改或新增 API 接口
- 更改配置项或环境变量
- 调整数据库表结构
- 修改用户界面流程

**文档位置**：
- API 文档：`README.md` 中的 API 文档章节
- 配置说明：`backend/configs/config.yaml` 及相关注释
- 架构说明：`docs/` 目录下的设计文档

**更新要求**：
- API 变更需在 `README.md` 中更新对应端点说明
- 新增配置项需在 `config.go` 中添加注释并更新文档
- 重大变更需在 `docs/` 中添加变更说明

**Section sources**
- [config_manager.go](file://backend/internal/app/config_manager.go#L1-L124)
- [README.md](file://README.md#L0-L77)